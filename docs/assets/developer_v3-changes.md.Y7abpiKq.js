import{_ as t,c as i,o as a,ag as e}from"./chunks/framework.B15mxHos.js";const k=JSON.parse('{"title":"LWT v3 Changes","description":"","frontmatter":{},"headers":[],"relativePath":"developer/v3-changes.md","filePath":"developer/v3-changes.md"}'),n={name:"developer/v3-changes.md"};function d(l,s,r,p,h,o){return a(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="lwt-v3-changes" tabindex="-1">LWT v3 Changes <a class="header-anchor" href="#lwt-v3-changes" aria-label="Permalink to &quot;LWT v3 Changes&quot;">​</a></h1><p>This document describes all the architectural and structural changes introduced in version 3.0.0 of Learning with Texts (LWT).</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Version 3 represents a major architectural refactoring of LWT, transitioning from a collection of 60+ standalone PHP files in the root directory to a modern, modular architecture. Key improvements include:</p><ul><li><strong>Front Controller Pattern:</strong> All requests route through <code>index.php</code></li><li><strong>MVC Structure:</strong> Controllers, Services, and Views organized by feature</li><li><strong>Modular Architecture:</strong> 10 feature modules following Clean Architecture principles</li><li><strong>Shared Infrastructure:</strong> Common database, HTTP, and UI utilities</li><li><strong>Dependency Injection:</strong> PSR-11 compatible container with service providers</li><li><strong>Multi-User Support:</strong> Optional data isolation for shared installations</li></ul><p>This change improves code organization, testability, and sets the foundation for future improvements.</p><h2 id="key-changes" tabindex="-1">Key Changes <a class="header-anchor" href="#key-changes" aria-label="Permalink to &quot;Key Changes&quot;">​</a></h2><h3 id="_1-front-controller-pattern" tabindex="-1">1. Front Controller Pattern <a class="header-anchor" href="#_1-front-controller-pattern" aria-label="Permalink to &quot;1. Front Controller Pattern&quot;">​</a></h3><p><strong>Before (v2):</strong> Each PHP page was accessed directly (e.g., <code>do_text.php</code>, <code>edit_words.php</code>).</p><p><strong>After (v3):</strong> All requests are routed through <code>index.php</code>, which serves as the single entry point.</p><ul><li>New <code>index.php</code> front controller handles all incoming requests</li><li>Added <code>.htaccess</code> with Apache mod_rewrite rules to route requests</li><li>Clean URLs supported (e.g., <code>/text/read</code> instead of <code>do_text.php</code>)</li><li>Automatic 301 redirects from legacy URLs to new routes</li></ul><h3 id="_2-new-directory-structure" tabindex="-1">2. New Directory Structure <a class="header-anchor" href="#_2-new-directory-structure" aria-label="Permalink to &quot;2. New Directory Structure&quot;">​</a></h3><h4 id="assets-reorganization" tabindex="-1">Assets Reorganization <a class="header-anchor" href="#assets-reorganization" aria-label="Permalink to &quot;Assets Reorganization&quot;">​</a></h4><p>Static assets have been consolidated into the <code>assets/</code> directory:</p><table tabindex="0"><thead><tr><th>Old Location</th><th>New Location</th></tr></thead><tbody><tr><td><code>icn/</code></td><td><code>assets/icons/</code></td></tr><tr><td><code>img/</code></td><td><code>assets/images/</code></td></tr><tr><td><code>css/</code></td><td><code>assets/css/</code></td></tr><tr><td><code>js/</code></td><td><code>assets/js/</code></td></tr><tr><td><code>themes/</code></td><td><code>assets/themes/</code></td></tr><tr><td><code>sounds/</code></td><td><code>assets/sounds/</code></td></tr><tr><td><code>iui/</code></td><td><code>assets/vendor/iui/</code></td></tr></tbody></table><h4 id="php-source-reorganization" tabindex="-1">PHP Source Reorganization <a class="header-anchor" href="#php-source-reorganization" aria-label="Permalink to &quot;PHP Source Reorganization&quot;">​</a></h4><p>All PHP source files have been reorganized into a modular structure:</p><table tabindex="0"><thead><tr><th>Old Location</th><th>New Location</th></tr></thead><tbody><tr><td><code>inc/</code></td><td><code>src/backend/Core/</code></td></tr><tr><td>Root PHP files (<code>do_text.php</code>, etc.)</td><td>Migrated to Controllers/Services</td></tr><tr><td>(new)</td><td><code>src/backend/Controllers/</code></td></tr><tr><td>(new)</td><td><code>src/backend/Router/</code></td></tr><tr><td>(new)</td><td><code>src/backend/Services/</code></td></tr><tr><td>(new)</td><td><code>src/backend/Views/</code></td></tr><tr><td>(new)</td><td><code>src/backend/Api/</code></td></tr><tr><td>(new)</td><td><code>src/Shared/</code> (cross-cutting infrastructure)</td></tr><tr><td>(new)</td><td><code>src/Modules/</code> (10 feature modules)</td></tr></tbody></table><h4 id="frontend-source-reorganization" tabindex="-1">Frontend Source Reorganization <a class="header-anchor" href="#frontend-source-reorganization" aria-label="Permalink to &quot;Frontend Source Reorganization&quot;">​</a></h4><p>Frontend source files moved from <code>src/</code> to <code>src/frontend/</code>:</p><table tabindex="0"><thead><tr><th>Old Location</th><th>New Location</th></tr></thead><tbody><tr><td><code>src/js/</code></td><td><code>src/frontend/js/</code></td></tr><tr><td><code>src/css/</code></td><td><code>src/frontend/css/base/</code></td></tr><tr><td><code>src/themes/</code></td><td><code>src/frontend/css/themes/</code></td></tr></tbody></table><h3 id="_3-routing-system" tabindex="-1">3. Routing System <a class="header-anchor" href="#_3-routing-system" aria-label="Permalink to &quot;3. Routing System&quot;">​</a></h3><p>A new routing system has been implemented in <code>src/backend/Router/</code>:</p><h4 id="router-src-backend-router-router-php" tabindex="-1">Router (<code>src/backend/Router/Router.php</code>) <a class="header-anchor" href="#router-src-backend-router-router-php" aria-label="Permalink to &quot;Router (\`src/backend/Router/Router.php\`)&quot;">​</a></h4><p>The <code>Router</code> class provides:</p><ul><li><strong>Route registration:</strong> Map URL paths to handlers</li><li><strong>Pattern matching:</strong> Support for dynamic routes (e.g., <code>/text/{id}</code>)</li><li><strong>Prefix routes:</strong> Handle API endpoints with multiple sub-paths</li><li><strong>Legacy URL support:</strong> Automatic redirects from old <code>.php</code> URLs</li><li><strong>HTTP method routing:</strong> Different handlers for GET, POST, etc.</li><li><strong>404/500 error handling:</strong> Built-in error pages</li></ul><h4 id="routes-configuration-src-backend-router-routes-php" tabindex="-1">Routes Configuration (<code>src/backend/Router/routes.php</code>) <a class="header-anchor" href="#routes-configuration-src-backend-router-routes-php" aria-label="Permalink to &quot;Routes Configuration (\`src/backend/Router/routes.php\`)&quot;">​</a></h4><p>All application routes are defined in this file, organized by feature:</p><ul><li><strong>Home:</strong> <code>/</code>, <code>/index.php</code></li><li><strong>Text:</strong> <code>/text/read</code>, <code>/text/edit</code>, <code>/texts</code>, <code>/text/display</code>, <code>/text/print</code>, etc.</li><li><strong>Word/Term:</strong> <code>/word/edit</code>, <code>/words/edit</code>, <code>/word/new</code>, <code>/word/show</code>, etc.</li><li><strong>Review:</strong> <code>/review</code>, <code>/review/set-status</code></li><li><strong>Language:</strong> <code>/languages</code>, <code>/languages/select-pair</code></li><li><strong>Tags:</strong> <code>/tags</code>, <code>/tags/text</code></li><li><strong>Feeds:</strong> <code>/feeds</code>, <code>/feeds/edit</code>, <code>/feeds/wizard</code></li><li><strong>Admin:</strong> <code>/admin/backup</code>, <code>/admin/wizard</code>, <code>/admin/statistics</code>, <code>/admin/settings</code>, etc.</li><li><strong>Mobile:</strong> <code>/mobile</code>, <code>/mobile/start</code></li><li><strong>API:</strong> <code>/api/v1</code>, <code>/api/translate</code>, <code>/api/google</code>, <code>/api/glosbe</code></li><li><strong>WordPress:</strong> <code>/wordpress/start</code>, <code>/wordpress/stop</code></li></ul><h3 id="_4-mvc-controllers" tabindex="-1">4. MVC Controllers <a class="header-anchor" href="#_4-mvc-controllers" aria-label="Permalink to &quot;4. MVC Controllers&quot;">​</a></h3><p>Controller classes are organized in two locations:</p><p><strong>Backend Controllers</strong> (<code>src/backend/Controllers/</code>):</p><table tabindex="0"><thead><tr><th>Controller</th><th>Purpose</th></tr></thead><tbody><tr><td><code>BaseController.php</code></td><td>Abstract base class with common functionality</td></tr><tr><td><code>HomeController.php</code></td><td>Home page</td></tr><tr><td><code>TextController.php</code></td><td>Text reading and management</td></tr><tr><td><code>TextPrintController.php</code></td><td>Text printing (plain and annotated)</td></tr><tr><td><code>WordController.php</code></td><td>Word/term management</td></tr><tr><td><code>ReviewController.php</code></td><td>Spaced repetition review interface</td></tr><tr><td><code>LanguageController.php</code></td><td>Language configuration</td></tr><tr><td><code>TagsController.php</code></td><td>Tag management</td></tr><tr><td><code>FeedsController.php</code></td><td>RSS feed management</td></tr><tr><td><code>AdminController.php</code></td><td>Admin functions (backup, settings, etc.)</td></tr><tr><td><code>MobileController.php</code></td><td>Mobile interface</td></tr><tr><td><code>ApiController.php</code></td><td>REST API endpoints</td></tr><tr><td><code>TranslationController.php</code></td><td>Translation API integration</td></tr><tr><td><code>WordPressController.php</code></td><td>WordPress integration</td></tr></tbody></table><p><strong>Module Controllers</strong> (<code>src/Modules/*/Http/</code>):</p><table tabindex="0"><thead><tr><th>Module</th><th>Controller</th><th>Purpose</th></tr></thead><tbody><tr><td>Text</td><td><code>TextController</code></td><td>Text CRUD and reading</td></tr><tr><td>Text</td><td><code>TextPrintController</code></td><td>Print and export</td></tr><tr><td>Vocabulary</td><td><code>VocabularyController</code></td><td>Term management</td></tr><tr><td>Language</td><td><code>LanguageController</code></td><td>Language settings</td></tr><tr><td>Tags</td><td><code>TagsController</code></td><td>Tag CRUD</td></tr><tr><td>Review</td><td><code>ReviewController</code></td><td>Spaced repetition</td></tr><tr><td>Feed</td><td><code>FeedController</code></td><td>RSS feeds</td></tr><tr><td>Admin</td><td><code>AdminController</code></td><td>Settings, backup</td></tr><tr><td>User</td><td><code>UserController</code></td><td>Authentication</td></tr><tr><td>Dictionary</td><td><code>DictionaryController</code></td><td>Dictionary lookup</td></tr></tbody></table><h4 id="basecontroller-features" tabindex="-1">BaseController Features <a class="header-anchor" href="#basecontroller-features" aria-label="Permalink to &quot;BaseController Features&quot;">​</a></h4><p>The <code>BaseController</code> provides helper methods for all controllers:</p><ul><li><code>render()</code> / <code>endRender()</code> - Page rendering with LWT header/footer</li><li><code>param()</code> / <code>get()</code> / <code>post()</code> - Request parameter access</li><li><code>isPost()</code> / <code>isGet()</code> - HTTP method checks</li><li><code>redirect()</code> - URL redirection</li><li><code>query()</code> / <code>execute()</code> / <code>getValue()</code> - Database operations</li><li><code>table()</code> - Table name with prefix</li><li><code>escape()</code> / <code>escapeNonNull()</code> - SQL escaping</li><li><code>json()</code> - JSON response output</li><li><code>sessionParam()</code> / <code>dbParam()</code> - Session/settings parameter handling</li></ul><h3 id="_5-services-layer" tabindex="-1">5. Services Layer <a class="header-anchor" href="#_5-services-layer" aria-label="Permalink to &quot;5. Services Layer&quot;">​</a></h3><p>Version 3 introduces a Services layer that extracts business logic from controllers.</p><p><strong>Backend Services</strong> (<code>src/backend/Services/</code>):</p><table tabindex="0"><thead><tr><th>Service</th><th>Purpose</th></tr></thead><tbody><tr><td><code>BackupService.php</code></td><td>Database backup and restore operations</td></tr><tr><td><code>DatabaseWizardService.php</code></td><td>Database setup and configuration</td></tr><tr><td><code>DemoService.php</code></td><td>Demo data installation</td></tr><tr><td><code>FeedService.php</code></td><td>RSS feed management logic</td></tr><tr><td><code>HomeService.php</code></td><td>Home page data and statistics</td></tr><tr><td><code>LanguageService.php</code></td><td>Language CRUD operations</td></tr><tr><td><code>MobileService.php</code></td><td>Mobile interface logic</td></tr><tr><td><code>ServerDataService.php</code></td><td>Server information gathering</td></tr><tr><td><code>SettingsService.php</code></td><td>Application settings management</td></tr><tr><td><code>StatisticsService.php</code></td><td>Usage statistics calculation</td></tr><tr><td><code>TableSetService.php</code></td><td>Table set management</td></tr><tr><td><code>TagService.php</code></td><td>Tag management operations</td></tr><tr><td><code>ReviewService.php</code></td><td>Review session logic</td></tr><tr><td><code>TextDisplayService.php</code></td><td>Annotated text display</td></tr><tr><td><code>TextPrintService.php</code></td><td>Text printing and export</td></tr><tr><td><code>TextService.php</code></td><td>Text CRUD and processing</td></tr><tr><td><code>TranslationService.php</code></td><td>Translation API integration</td></tr><tr><td><code>TtsService.php</code></td><td>Text-to-speech configuration</td></tr><tr><td><code>WordPressService.php</code></td><td>WordPress integration logic</td></tr><tr><td><code>WordService.php</code></td><td>Word/term management operations</td></tr><tr><td><code>WordListService.php</code></td><td>Word list filtering, pagination, and bulk operations</td></tr><tr><td><code>WordUploadService.php</code></td><td>Word import/upload operations</td></tr></tbody></table><p><strong>Module Services</strong> (<code>src/Modules/*/Application/Services/</code>):</p><table tabindex="0"><thead><tr><th>Module</th><th>Key Services</th></tr></thead><tbody><tr><td>Text</td><td>TextReadingService, TextDisplayService, SentenceService, AnnotationService</td></tr><tr><td>Vocabulary</td><td>WordService, WordListService, TermStatusService, ExportService</td></tr><tr><td>Language</td><td>TextParsingService</td></tr><tr><td>Tags</td><td>TagService, TagAssociationService</td></tr><tr><td>Review</td><td>ReviewService, ReviewGenerationService, ScoreCalculationService</td></tr><tr><td>Feed</td><td>FeedService, ArticleService, FeedParsingService</td></tr><tr><td>User</td><td>AuthService, PasswordService, EmailService</td></tr><tr><td>Admin</td><td>MediaService, TtsService, SessionCleaner</td></tr><tr><td>Dictionary</td><td>LocalDictionaryService, TranslationService</td></tr></tbody></table><p>Services follow the pattern of extracting complex business logic for better testability. Module services are organized alongside Use Cases in the Application layer.</p><h3 id="_6-views-architecture" tabindex="-1">6. Views Architecture <a class="header-anchor" href="#_6-views-architecture" aria-label="Permalink to &quot;6. Views Architecture&quot;">​</a></h3><p>Version 3 introduces a proper Views directory structure.</p><p><strong>Backend Views</strong> (<code>src/backend/Views/</code>):</p><table tabindex="0"><thead><tr><th>Directory</th><th>Purpose</th></tr></thead><tbody><tr><td><code>Admin/</code></td><td>Admin interface templates</td></tr><tr><td><code>Feed/</code></td><td>Feed management templates</td></tr><tr><td><code>Home/</code></td><td>Home page templates</td></tr><tr><td><code>Language/</code></td><td>Language configuration templates</td></tr><tr><td><code>Mobile/</code></td><td>Mobile interface templates</td></tr><tr><td><code>Tags/</code></td><td>Tag management templates</td></tr><tr><td><code>Text/</code></td><td>Text reading/editing templates</td></tr><tr><td><code>TextPrint/</code></td><td>Text printing templates</td></tr><tr><td><code>Word/</code></td><td>Word/term templates</td></tr></tbody></table><p><strong>Module Views</strong> (<code>src/Modules/*/Views/</code>):</p><p>Each module contains its own Views directory with templates specific to that feature:</p><table tabindex="0"><thead><tr><th>Module</th><th>Template Count</th><th>Key Templates</th></tr></thead><tbody><tr><td>Text</td><td>18</td><td>read_text.php, edit_form.php, import_long_form.php</td></tr><tr><td>Vocabulary</td><td>22</td><td>form_edit_existing.php, list_table.php, upload_form.php</td></tr><tr><td>Language</td><td>5</td><td>index.php, edit_form.php, new_form.php</td></tr><tr><td>Tags</td><td>5</td><td>index.php, create_form.php, edit_form.php</td></tr><tr><td>Review</td><td>6</td><td>review_form.php, review_result.php, next_word.php</td></tr><tr><td>Feed</td><td>8</td><td>index.php, articles.php, import_article.php</td></tr><tr><td>User</td><td>6</td><td>login.php, register.php, profile.php</td></tr><tr><td>Admin</td><td>8</td><td>settings.php, backup.php, statistics.php</td></tr><tr><td>Home</td><td>2</td><td>index.php, dashboard.php</td></tr><tr><td>Dictionary</td><td>2</td><td>index.php, import.php</td></tr></tbody></table><p><strong>View Helper Classes</strong> (<code>src/Shared/UI/Helpers/</code>):</p><table tabindex="0"><thead><tr><th>Class</th><th>Purpose</th></tr></thead><tbody><tr><td><code>FormHelper</code></td><td>Form attribute generation (checked, selected)</td></tr><tr><td><code>PageLayoutHelper</code></td><td>Page layout elements (navbar, footers)</td></tr><tr><td><code>IconHelper</code></td><td>Lucide SVG icon rendering (replaced 97 legacy Fugue PNG icons)</td></tr><tr><td><code>TagHelper</code></td><td>HTML tag utilities</td></tr><tr><td><code>SelectOptionsBuilder</code></td><td>HTML select option building</td></tr></tbody></table><h3 id="_7-legacy-file-migration" tabindex="-1">7. Legacy File Migration <a class="header-anchor" href="#_7-legacy-file-migration" aria-label="Permalink to &quot;7. Legacy File Migration&quot;">​</a></h3><p>All 59 root-level PHP page files have been fully migrated to the MVC pattern with Controllers, Services, and Views. The <code>src/backend/Legacy/</code> directory has been removed as all files have been migrated.</p><p>The following table shows the migration status of all original files:</p><table tabindex="0"><thead><tr><th>Old Filename</th><th>Migration Status</th></tr></thead><tbody><tr><td><code>do_text.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>do_text_header.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>do_text_text.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>edit_texts.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>display_impr_text.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>print_impr_text.php</code></td><td>Fully migrated to <code>TextPrintController</code></td></tr><tr><td><code>print_text.php</code></td><td>Fully migrated to <code>TextPrintController</code></td></tr><tr><td><code>check_text.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>edit_archivedtexts.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>long_text_import.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>set_text_mode.php</code></td><td>Fully migrated to <code>TextController</code></td></tr><tr><td><code>do_test.php</code></td><td>Fully migrated to <code>TestController</code></td></tr><tr><td><code>do_test_header.php</code></td><td>Fully migrated to <code>TestController</code></td></tr><tr><td><code>do_test_table.php</code></td><td>Fully migrated to <code>TestController</code></td></tr><tr><td><code>do_test_test.php</code></td><td>Fully migrated to <code>TestController</code></td></tr><tr><td><code>set_test_status.php</code></td><td>Fully migrated to <code>TestController</code></td></tr><tr><td><code>edit_word.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>edit_words.php</code></td><td>Fully migrated to <code>WordController@list</code></td></tr><tr><td><code>edit_mword.php</code></td><td>Fully migrated to <code>WordController@editMulti</code></td></tr><tr><td><code>edit_tword.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>delete_word.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>delete_mword.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>new_word.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>show_word.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>upload_words.php</code></td><td>Fully migrated to <code>WordController@upload</code></td></tr><tr><td><code>all_words_wellknown.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>bulk_translate_words.php</code></td><td>Fully migrated to <code>WordController@bulkTranslate</code></td></tr><tr><td><code>inline_edit.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>insert_word_wellknown.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>insert_word_ignore.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>set_word_status.php</code></td><td>Fully migrated to <code>WordController</code></td></tr><tr><td><code>edit_languages.php</code></td><td>Fully migrated to <code>LanguageController</code></td></tr><tr><td><code>select_lang_pair.php</code></td><td>Fully migrated to <code>LanguageController</code></td></tr><tr><td><code>edit_tags.php</code></td><td>Fully migrated to <code>TagsController</code></td></tr><tr><td><code>edit_texttags.php</code></td><td>Fully migrated to <code>TagsController</code></td></tr><tr><td><code>do_feeds.php</code></td><td>Fully migrated to <code>FeedsController</code></td></tr><tr><td><code>edit_feeds.php</code></td><td>Fully migrated to <code>FeedsController</code></td></tr><tr><td><code>feed_wizard.php</code></td><td>Fully migrated to <code>FeedsController</code></td></tr><tr><td><code>backup_restore.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>database_wizard.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>statistics.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>install_demo.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>settings.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>set_word_on_hover.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>text_to_speech_settings.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>table_set_management.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>server_data.php</code></td><td>Fully migrated to <code>AdminController</code></td></tr><tr><td><code>mobile.php</code></td><td>Fully migrated to <code>MobileController</code></td></tr><tr><td><code>start.php</code></td><td>Fully migrated to <code>MobileController</code></td></tr><tr><td><code>api.php</code></td><td>Fully migrated to <code>ApiController</code></td></tr><tr><td><code>trans.php</code></td><td>Fully migrated to <code>TranslationController</code></td></tr><tr><td><code>ggl.php</code></td><td>Fully migrated to <code>TranslationController</code></td></tr><tr><td><code>glosbe_api.php</code></td><td>Fully migrated to <code>TranslationController</code></td></tr><tr><td><code>wp_lwt_start.php</code></td><td>Fully migrated to <code>WordPressController</code></td></tr><tr><td><code>wp_lwt_stop.php</code></td><td>Fully migrated to <code>WordPressController</code></td></tr><tr><td><code>index.php</code> (old)</td><td>Fully migrated to <code>HomeController</code></td></tr></tbody></table><h3 id="_8-apache-configuration-htaccess" tabindex="-1">8. Apache Configuration (<code>.htaccess</code>) <a class="header-anchor" href="#_8-apache-configuration-htaccess" aria-label="Permalink to &quot;8. Apache Configuration (\`.htaccess\`)&quot;">​</a></h3><p>New <code>.htaccess</code> file provides:</p><ul><li><strong>URL rewriting:</strong> Routes all non-file requests to <code>index.php</code></li><li><strong>Legacy redirects:</strong> 301 redirects from old asset paths (<code>/icn/</code>, <code>/css/</code>, etc.)</li><li><strong>Security:</strong> Denies access to sensitive files (<code>connect.inc.php</code>, <code>composer.json</code>, <code>.env</code>)</li><li><strong>Performance:</strong> GZIP compression and cache headers for static assets</li><li><strong>Static file handling:</strong> Direct serving of CSS, JS, images, and fonts</li></ul><h3 id="_9-test-suite" tabindex="-1">9. Test Suite <a class="header-anchor" href="#_9-test-suite" aria-label="Permalink to &quot;9. Test Suite&quot;">​</a></h3><p>Test files for the routing system:</p><ul><li><code>tests/src/backend/Router/RouterTest.php</code> - Unit tests for the Router class</li><li><code>tests/src/backend/Router/RoutesTest.php</code> - Integration tests for all routes</li></ul><p>Test coverage includes:</p><ul><li>Route registration</li><li>HTTP method routing</li><li>Pattern matching</li><li>Legacy URL redirects</li><li>Prefix route handling</li><li>404 handling</li></ul><h2 id="backward-compatibility" tabindex="-1">Backward Compatibility <a class="header-anchor" href="#backward-compatibility" aria-label="Permalink to &quot;Backward Compatibility&quot;">​</a></h2><p>Version 3 maintains full backward compatibility:</p><ol><li><strong>Legacy URLs:</strong> All old URLs (e.g., <code>do_text.php?text=1</code>) automatically redirect to new routes with 301 status</li><li><strong>Asset paths:</strong> Old asset paths (e.g., <code>/icn/</code>, <code>/css/</code>) redirect to new <code>assets/</code> locations</li><li><strong>Query strings:</strong> All query parameters are preserved during redirects</li><li><strong>API compatibility:</strong> REST API endpoints continue to work at both old and new URLs</li></ol><h2 id="migration-guide-for-developers" tabindex="-1">Migration Guide for Developers <a class="header-anchor" href="#migration-guide-for-developers" aria-label="Permalink to &quot;Migration Guide for Developers&quot;">​</a></h2><h3 id="updating-internal-links" tabindex="-1">Updating Internal Links <a class="header-anchor" href="#updating-internal-links" aria-label="Permalink to &quot;Updating Internal Links&quot;">​</a></h3><p>If you have custom code or bookmarks:</p><table tabindex="0"><thead><tr><th>Old URL</th><th>New URL</th></tr></thead><tbody><tr><td><code>do_text.php?text=1</code></td><td><code>/text/read?text=1</code></td></tr><tr><td><code>edit_words.php</code></td><td><code>/words/edit</code></td></tr><tr><td><code>do_test.php</code></td><td><code>/review</code></td></tr><tr><td><code>edit_languages.php</code></td><td><code>/languages</code></td></tr><tr><td><code>backup_restore.php</code></td><td><code>/admin/backup</code></td></tr><tr><td><code>api.php/v1/...</code></td><td><code>/api/v1/...</code></td></tr></tbody></table><h3 id="updating-include-paths" tabindex="-1">Updating Include Paths <a class="header-anchor" href="#updating-include-paths" aria-label="Permalink to &quot;Updating Include Paths&quot;">​</a></h3><p>If extending LWT with custom code:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Old way</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;inc/session_utility.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// New way (from root or with include_path set)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;src/backend/Core/session_utility.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="creating-new-controllers" tabindex="-1">Creating New Controllers <a class="header-anchor" href="#creating-new-controllers" aria-label="Permalink to &quot;Creating New Controllers&quot;">​</a></h3><p>To add new functionality:</p><ol><li>Create a controller in <code>src/backend/Controllers/</code></li><li>Extend <code>BaseController</code></li><li>Add routes in <code>src/backend/Router/routes.php</code></li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/backend/Controllers/MyController.php</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lwt\\Controllers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> myAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $params)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Include legacy file or implement new logic</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        include</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __DIR__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/../Legacy/my_file.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In routes.php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$router</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/my/route&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;MyController@myAction&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="creating-new-services" tabindex="-1">Creating New Services <a class="header-anchor" href="#creating-new-services" aria-label="Permalink to &quot;Creating New Services&quot;">​</a></h3><p>To extract business logic:</p><ol><li>Create a service in <code>src/backend/Services/</code></li><li>Inject dependencies via constructor</li><li>Use from controllers</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/backend/Services/MyService.php</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lwt\\Services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyService</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> array</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Business logic here</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In controller</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$service </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MyService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="creating-new-modules-recommended" tabindex="-1">Creating New Modules (Recommended) <a class="header-anchor" href="#creating-new-modules-recommended" aria-label="Permalink to &quot;Creating New Modules (Recommended)&quot;">​</a></h3><p>For new features, prefer creating a new module in <code>src/Modules/</code>:</p><ol><li>Create the module directory structure:</li></ol><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/Modules/MyFeature/</span></span>
<span class="line"><span>├── Application/</span></span>
<span class="line"><span>│   ├── MyFeatureFacade.php</span></span>
<span class="line"><span>│   ├── Services/</span></span>
<span class="line"><span>│   └── UseCases/</span></span>
<span class="line"><span>├── Domain/</span></span>
<span class="line"><span>│   ├── Entities/</span></span>
<span class="line"><span>│   └── MyFeatureRepositoryInterface.php</span></span>
<span class="line"><span>├── Http/</span></span>
<span class="line"><span>│   └── MyFeatureController.php</span></span>
<span class="line"><span>├── Infrastructure/</span></span>
<span class="line"><span>│   └── MySqlMyFeatureRepository.php</span></span>
<span class="line"><span>├── Views/</span></span>
<span class="line"><span>└── MyFeatureServiceProvider.php</span></span></code></pre></div><ol start="2"><li>Create the ServiceProvider:</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/Modules/MyFeature/MyFeatureServiceProvider.php</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lwt\\Modules\\MyFeature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Container\\ServiceProviderInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyFeatureServiceProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServiceProviderInterface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ContainerInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            MyFeatureRepositoryInterface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            MySqlMyFeatureRepository</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MyFeatureFacade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> boot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ContainerInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ol start="3"><li><p>Register the provider in <code>index.php</code> or the container bootstrap.</p></li><li><p>Add routes in <code>src/backend/Router/routes.php</code>.</p></li></ol><h3 id="using-the-di-container" tabindex="-1">Using the DI Container <a class="header-anchor" href="#using-the-di-container" aria-label="Permalink to &quot;Using the DI Container&quot;">​</a></h3><p>Register services via the container instead of manual instantiation:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Container\\Container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Register a service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$container </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MyService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Retrieve a service (auto-wires dependencies)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$service </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MyService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="database-queries-with-prepared-statements" tabindex="-1">Database Queries with Prepared Statements <a class="header-anchor" href="#database-queries-with-prepared-statements" aria-label="Permalink to &quot;Database Queries with Prepared Statements&quot;">​</a></h3><p>Always use prepared statements for user input:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Database\\Connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Preferred: Prepared statements</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Connection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preparedFetchAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> words </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WoLgID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WoStatus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [$langId, $status]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// For complex queries: QueryBuilder</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Database\\QueryBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> QueryBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;words&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$words </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $query</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WoLgID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;=&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $langId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WoStatus&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&gt;=&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orderBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WoText&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">limit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="statistics" tabindex="-1">Statistics <a class="header-anchor" href="#statistics" aria-label="Permalink to &quot;Statistics&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Metric</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>PHP files in root</td><td>60+</td><td>1 (<code>index.php</code>)</td></tr><tr><td>Root directories</td><td>10+</td><td>6 (assets, db, docs, media, src, tests)</td></tr><tr><td>Controllers</td><td>0</td><td>20+</td></tr><tr><td>Services</td><td>0</td><td>40+</td></tr><tr><td>View directories</td><td>0</td><td>9</td></tr><tr><td>Legacy PHP files remaining</td><td>60+</td><td>0</td></tr><tr><td>Route definitions</td><td>0</td><td>80+</td></tr><tr><td>Test files for routing</td><td>0</td><td>2 (1000+ lines)</td></tr><tr><td>Feature modules</td><td>0</td><td>10</td></tr><tr><td>Use case classes</td><td>0</td><td>76</td></tr><tr><td>API handlers</td><td>0</td><td>20+</td></tr></tbody></table><h3 id="_10-global-variables-refactoring" tabindex="-1">10. Global Variables Refactoring <a class="header-anchor" href="#_10-global-variables-refactoring" aria-label="Permalink to &quot;10. Global Variables Refactoring&quot;">​</a></h3><p>Version 3 introduces the <code>Globals</code> class to clearly identify and manage global state throughout the application.</p><h4 id="the-problem-with-globals" tabindex="-1">The Problem with Globals <a class="header-anchor" href="#the-problem-with-globals" aria-label="Permalink to &quot;The Problem with Globals&quot;">​</a></h4><p>Previously, LWT used PHP global variables scattered throughout the codebase:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Old way - globals are implicit and hard to track</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> someFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $tbpref;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $DBCONNECTION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $sql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $tbpref </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;words&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This pattern had several issues:</p><ul><li>Dependencies were hidden inside functions</li><li>Hard to trace where globals were initialized</li><li>Testing required manipulating <code>$GLOBALS</code> directly</li><li>No type safety or IDE autocompletion</li></ul><h4 id="the-new-globals-class" tabindex="-1">The New Globals Class <a class="header-anchor" href="#the-new-globals-class" aria-label="Permalink to &quot;The New Globals Class&quot;">​</a></h4><p>A new class <code>Lwt\\Core\\Globals</code> (<code>src/backend/Core/Globals.php</code>) provides explicit, type-safe access to global state:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// New way - dependencies are explicit</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Core\\Globals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> someFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $prefix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTablePrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDbConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $sql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $prefix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;words&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="available-methods" tabindex="-1">Available Methods <a class="header-anchor" href="#available-methods" aria-label="Permalink to &quot;Available Methods&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Method</th><th>Description</th><th>Replaces</th></tr></thead><tbody><tr><td><code>Globals::getDbConnection()</code></td><td>Get the mysqli database connection</td><td><code>global $DBCONNECTION</code></td></tr><tr><td><code>Globals::getTablePrefix()</code></td><td>Get the database table prefix</td><td><code>global $tbpref</code></td></tr><tr><td><code>Globals::table($name)</code></td><td>Get prefixed table name (e.g., <code>table(&#39;words&#39;)</code> → <code>lwt_words</code>)</td><td><code>$tbpref . &#39;words&#39;</code></td></tr><tr><td><code>Globals::isTablePrefixFixed()</code></td><td>Check if prefix is fixed in connect.inc.php</td><td><code>global $fixed_tbpref</code></td></tr><tr><td><code>Globals::getDatabaseName()</code></td><td>Get the database name</td><td><code>global $dbname</code></td></tr><tr><td><code>Globals::isDebug()</code></td><td>Check if debug mode is enabled</td><td><code>global $debug</code></td></tr><tr><td><code>Globals::getDebug()</code></td><td>Get debug value as integer (0 or 1)</td><td><code>global $debug</code></td></tr><tr><td><code>Globals::shouldDisplayErrors()</code></td><td>Check if error display is enabled</td><td><code>global $dsplerrors</code></td></tr><tr><td><code>Globals::shouldDisplayTime()</code></td><td>Check if execution time display is enabled</td><td><code>global $dspltime</code></td></tr></tbody></table><h4 id="setter-methods-for-initialization" tabindex="-1">Setter Methods (for initialization) <a class="header-anchor" href="#setter-methods-for-initialization" aria-label="Permalink to &quot;Setter Methods (for initialization)&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><code>Globals::setDbConnection($conn)</code></td><td>Set the database connection</td></tr><tr><td><code>Globals::setTablePrefix($prefix, $fixed)</code></td><td>Set the table prefix</td></tr><tr><td><code>Globals::setDatabaseName($name)</code></td><td>Set the database name</td></tr><tr><td><code>Globals::setDebug($value)</code></td><td>Set debug mode</td></tr><tr><td><code>Globals::setDisplayErrors($value)</code></td><td>Set error display mode</td></tr><tr><td><code>Globals::setDisplayTime($value)</code></td><td>Set time display mode</td></tr><tr><td><code>Globals::reset()</code></td><td>Reset all globals (for testing)</td></tr></tbody></table><h4 id="all-global-variables-removed" tabindex="-1">All Global Variables Removed <a class="header-anchor" href="#all-global-variables-removed" aria-label="Permalink to &quot;All Global Variables Removed&quot;">​</a></h4><p>All global variables have been <strong>fully removed</strong> from the LWT codebase. The <code>Globals</code> class is now the only way to access this state:</p><table tabindex="0"><thead><tr><th>Removed Global</th><th>Replacement</th></tr></thead><tbody><tr><td><code>$tbpref</code></td><td><code>Globals::getTablePrefix()</code> or <code>Globals::table(&#39;tablename&#39;)</code></td></tr><tr><td><code>$fixed_tbpref</code></td><td><code>Globals::isTablePrefixFixed()</code></td></tr><tr><td><code>$DBCONNECTION</code></td><td><code>Globals::getDbConnection()</code></td></tr><tr><td><code>$debug</code></td><td><code>Globals::isDebug()</code> / <code>Globals::getDebug()</code></td></tr><tr><td><code>$dbname</code></td><td><code>Globals::getDatabaseName()</code></td></tr><tr><td><code>$dsplerrors</code></td><td><code>Globals::shouldDisplayErrors()</code></td></tr><tr><td><code>$dspltime</code></td><td><code>Globals::shouldDisplayTime()</code></td></tr></tbody></table><p>No <code>global $variable</code> declarations remain in any source files. The backward compatibility layer that previously synchronized <code>Globals</code> with <code>$GLOBALS</code> has also been removed.</p><h4 id="migration-guide" tabindex="-1">Migration Guide <a class="header-anchor" href="#migration-guide" aria-label="Permalink to &quot;Migration Guide&quot;">​</a></h4><p>To update your code:</p><ol><li><p>Add the use statement at the top of your file:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Core\\Globals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div></li><li><p>Replace global declarations with method calls:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Before</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> myFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $tbpref, $DBCONNECTION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $sql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $tbpref </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;words&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mysqli_query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($DBCONNECTION, $sql);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// After</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> myFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $sql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;words&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mysqli_query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDbConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), $sql);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>For debug checks:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Before</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $debug;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($debug) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// After</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div></li></ol><h3 id="_11-environment-based-configuration-env" tabindex="-1">11. Environment-Based Configuration (.env) <a class="header-anchor" href="#_11-environment-based-configuration-env" aria-label="Permalink to &quot;11. Environment-Based Configuration (.env)&quot;">​</a></h3><p>Version 3 introduces <code>.env</code> file support for database configuration, replacing the legacy <code>connect.inc.php</code> approach.</p><h4 id="the-problem-with-connect-inc-php" tabindex="-1">The Problem with connect.inc.php <a class="header-anchor" href="#the-problem-with-connect-inc-php" aria-label="Permalink to &quot;The Problem with connect.inc.php&quot;">​</a></h4><p>Previously, LWT used PHP files for configuration:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// connect.inc.php (or connect_xampp.inc.php, connect_mamp.inc.php, etc.)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$userid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;root&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$passwd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dbname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;learning-with-texts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>This approach had issues:</p><ul><li>PHP files can execute code, creating security risks</li><li>Different template files for each environment (XAMPP, MAMP, etc.)</li><li>Not compatible with modern deployment workflows</li><li>Harder to use with Docker and container orchestration</li></ul><h4 id="the-new-env-approach" tabindex="-1">The New .env Approach <a class="header-anchor" href="#the-new-env-approach" aria-label="Permalink to &quot;The New .env Approach&quot;">​</a></h4><p>LWT now supports <code>.env</code> files, the modern standard for application configuration:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .env file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">learning-with-texts</span></span></code></pre></div><h4 id="configuration-file-priority" tabindex="-1">Configuration File Priority <a class="header-anchor" href="#configuration-file-priority" aria-label="Permalink to &quot;Configuration File Priority&quot;">​</a></h4><p>LWT loads configuration in this order:</p><ol><li><code>.env</code> file in the project root (if exists) - <strong>recommended</strong></li><li><code>connect.inc.php</code> (legacy, for backward compatibility)</li></ol><h4 id="available-environment-variables" tabindex="-1">Available Environment Variables <a class="header-anchor" href="#available-environment-variables" aria-label="Permalink to &quot;Available Environment Variables&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Variable</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>DB_HOST</code></td><td>Database server hostname or IP</td><td><code>localhost</code></td></tr><tr><td><code>DB_USER</code></td><td>Database username</td><td><code>root</code></td></tr><tr><td><code>DB_PASSWORD</code></td><td>Database password</td><td>(empty)</td></tr><tr><td><code>DB_NAME</code></td><td>Database name</td><td><code>learning-with-texts</code></td></tr><tr><td><code>DB_SOCKET</code></td><td>Database socket (optional)</td><td>(empty)</td></tr><tr><td><code>DB_TABLE_PREFIX</code></td><td>Table prefix for multi-instance setups</td><td>(empty)</td></tr></tbody></table><h4 id="setting-up-env" tabindex="-1">Setting Up .env <a class="header-anchor" href="#setting-up-env" aria-label="Permalink to &quot;Setting Up .env&quot;">​</a></h4><ol><li><p>Copy the template file:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre></div></li><li><p>Edit <code>.env</code> with your database credentials:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_username</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_password</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_database</span></span></code></pre></div></li><li><p>That&#39;s it! LWT will automatically use these values.</p></li></ol><h4 id="environment-specific-examples" tabindex="-1">Environment-Specific Examples <a class="header-anchor" href="#environment-specific-examples" aria-label="Permalink to &quot;Environment-Specific Examples&quot;">​</a></h4><p><strong>Standard localhost:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">learning-with-texts</span></span></code></pre></div><p><strong>MAMP (macOS):</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost:8889</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">learning-with-texts</span></span></code></pre></div><p><strong>Docker:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lwt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">secret</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lwt</span></span></code></pre></div><p><strong>With table prefix (multiple instances):</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared_database</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_TABLE_PREFIX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lwt_</span></span></code></pre></div><h4 id="envloader-class" tabindex="-1">EnvLoader Class <a class="header-anchor" href="#envloader-class" aria-label="Permalink to &quot;EnvLoader Class&quot;">​</a></h4><p>The <code>Lwt\\Core\\EnvLoader</code> class (<code>src/backend/Core/Bootstrap/EnvLoader.php</code>) provides the parsing functionality:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Core\\EnvLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Load .env file</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">EnvLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/path/to/.env&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get values with defaults</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$host </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EnvLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DB_HOST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;localhost&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get as boolean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$debug </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EnvLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEBUG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get as integer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EnvLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DB_PORT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3306</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get complete database config</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EnvLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDatabaseConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h4 id="deprecated-files" tabindex="-1">Deprecated Files <a class="header-anchor" href="#deprecated-files" aria-label="Permalink to &quot;Deprecated Files&quot;">​</a></h4><p>The following files are deprecated and will be removed in a future version:</p><table tabindex="0"><thead><tr><th>Deprecated File</th><th>Replacement</th></tr></thead><tbody><tr><td><code>connect.inc.php</code></td><td><code>.env</code></td></tr><tr><td><code>connect_xampp.inc.php</code></td><td><code>.env</code> with XAMPP settings</td></tr><tr><td><code>connect_mamp.inc.php</code></td><td><code>.env</code> with MAMP settings</td></tr><tr><td><code>connect_easyphp.inc.php</code></td><td><code>.env</code> with EasyPHP settings</td></tr><tr><td><code>connect_wordpress.inc.php</code></td><td><code>.env</code> with WordPress settings</td></tr></tbody></table><h4 id="migrating-to-env" tabindex="-1">Migrating to .env <a class="header-anchor" href="#migrating-to-env" aria-label="Permalink to &quot;Migrating to .env&quot;">​</a></h4><p>To migrate from <code>connect.inc.php</code> to <code>.env</code>:</p><ol><li><p>Create <code>.env</code> from the template:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre></div></li><li><p>Copy your values from <code>connect.inc.php</code>:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Old connect.inc.php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$userid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;myuser&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$passwd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;mypass&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$dbname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;mydb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Becomes:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># New .env</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myuser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mypass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mydb</span></span></code></pre></div></li><li><p>Test that LWT works with the new configuration</p></li><li><p>Optionally, remove <code>connect.inc.php</code> (LWT will use <code>.env</code> exclusively)</p></li></ol><h3 id="_12-ajax-files-consolidation" tabindex="-1">12. AJAX Files Consolidation <a class="header-anchor" href="#_12-ajax-files-consolidation" aria-label="Permalink to &quot;12. AJAX Files Consolidation&quot;">​</a></h3><p>Version 3 consolidates all legacy AJAX files into a structured API with dedicated handlers.</p><h4 id="the-problem-with-scattered-ajax-files" tabindex="-1">The Problem with Scattered AJAX Files <a class="header-anchor" href="#the-problem-with-scattered-ajax-files" aria-label="Permalink to &quot;The Problem with Scattered AJAX Files&quot;">​</a></h4><p>Previously, LWT had 15 separate <code>ajax_*.php</code> files:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ajax_add_term_transl.php     ajax_save_impr_text.php</span></span>
<span class="line"><span>ajax_chg_term_status.php     ajax_save_setting.php</span></span>
<span class="line"><span>ajax_check_regexp.php        ajax_save_text_position.php</span></span>
<span class="line"><span>ajax_edit_impr_text.php      ajax_show_imported_terms.php</span></span>
<span class="line"><span>ajax_get_phonetic.php        ajax_show_sentences.php</span></span>
<span class="line"><span>ajax_get_theme.php           ajax_show_similar_terms.php</span></span>
<span class="line"><span>ajax_load_feed.php           ajax_update_media_select.php</span></span>
<span class="line"><span>ajax_word_counts.php</span></span></code></pre></div><p>This pattern had several issues:</p><ul><li><strong>15 separate entry points</strong> - Hard to maintain, secure, and document</li><li><strong>Inconsistent response formats</strong> - Some returned HTML, some JSON, some JavaScript</li><li><strong>No HTTP status codes</strong> - Always returned 200 OK, even on errors</li><li><strong>No input validation</strong> - Mixed usage of <code>$_GET</code>, <code>$_POST</code>, <code>$_REQUEST</code></li></ul><h4 id="the-new-api-structure" tabindex="-1">The New API Structure <a class="header-anchor" href="#the-new-api-structure" aria-label="Permalink to &quot;The New API Structure&quot;">​</a></h4><p>All AJAX functionality has been consolidated into <code>src/backend/Api/V1/</code>:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/backend/Api/V1/</span></span>
<span class="line"><span>├── ApiV1.php           # Main API router</span></span>
<span class="line"><span>├── Endpoints.php       # Endpoint definitions</span></span>
<span class="line"><span>└── Handlers/</span></span>
<span class="line"><span>    ├── FeedHandler.php</span></span>
<span class="line"><span>    ├── ImportHandler.php</span></span>
<span class="line"><span>    ├── ImprovedTextHandler.php</span></span>
<span class="line"><span>    ├── LanguageHandler.php</span></span>
<span class="line"><span>    ├── MediaHandler.php</span></span>
<span class="line"><span>    ├── ReviewHandler.php</span></span>
<span class="line"><span>    ├── SettingsHandler.php</span></span>
<span class="line"><span>    ├── StatisticsHandler.php</span></span>
<span class="line"><span>    ├── TermHandler.php</span></span>
<span class="line"><span>    ├── TextHandler.php</span></span>
<span class="line"><span>    └── Response.php</span></span></code></pre></div><h4 id="rest-endpoint-mapping" tabindex="-1">REST Endpoint Mapping <a class="header-anchor" href="#rest-endpoint-mapping" aria-label="Permalink to &quot;REST Endpoint Mapping&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Old File</th><th>New REST Endpoint</th><th>Handler</th></tr></thead><tbody><tr><td><code>ajax_add_term_transl.php</code></td><td><code>/api.php/v1/terms/new</code></td><td>TermHandler</td></tr><tr><td><code>ajax_chg_term_status.php</code></td><td><code>/api.php/v1/terms/{id}/status/up</code> or <code>/down</code></td><td>TermHandler</td></tr><tr><td><code>ajax_get_phonetic.php</code></td><td><code>/api.php/v1/phonetic-reading</code></td><td>LanguageHandler</td></tr><tr><td><code>ajax_get_theme.php</code></td><td><code>/api.php/v1/settings/theme-path</code></td><td>SettingsHandler</td></tr><tr><td><code>ajax_load_feed.php</code></td><td><code>/api.php/v1/feeds/{id}/load</code></td><td>FeedHandler</td></tr><tr><td><code>ajax_save_impr_text.php</code></td><td><code>/api.php/v1/texts/{id}/annotation</code></td><td>TextHandler</td></tr><tr><td><code>ajax_save_setting.php</code></td><td><code>/api.php/v1/settings</code></td><td>SettingsHandler</td></tr><tr><td><code>ajax_save_text_position.php</code></td><td><code>/api.php/v1/texts/{id}/reading-position</code></td><td>TextHandler</td></tr><tr><td><code>ajax_show_imported_terms.php</code></td><td><code>/api.php/v1/terms/imported</code></td><td>ImportHandler</td></tr><tr><td><code>ajax_show_sentences.php</code></td><td><code>/api.php/v1/sentences-with-term</code></td><td>TermHandler</td></tr><tr><td><code>ajax_show_similar_terms.php</code></td><td><code>/api.php/v1/similar-terms</code></td><td>TermHandler</td></tr><tr><td><code>ajax_update_media_select.php</code></td><td><code>/api.php/v1/media-files</code></td><td>MediaHandler</td></tr><tr><td><code>ajax_word_counts.php</code></td><td><code>/api.php/v1/texts/statistics</code></td><td>StatisticsHandler</td></tr></tbody></table><h4 id="benefits" tabindex="-1">Benefits <a class="header-anchor" href="#benefits" aria-label="Permalink to &quot;Benefits&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Aspect</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>Entry points</td><td>15 separate files</td><td>1 centralized API</td></tr><tr><td>Response format</td><td>HTML/JSON/JS (mixed)</td><td>JSON (consistent)</td></tr><tr><td>HTTP status codes</td><td>Always 200</td><td>200/400/404/405</td></tr><tr><td>Error handling</td><td>Minimal/none</td><td>Structured JSON errors</td></tr><tr><td>Code organization</td><td>Flat files</td><td>Handler classes</td></tr><tr><td>Maintainability</td><td>Hard to track</td><td>Single namespace</td></tr></tbody></table><h4 id="migration-for-custom-code" tabindex="-1">Migration for Custom Code <a class="header-anchor" href="#migration-for-custom-code" aria-label="Permalink to &quot;Migration for Custom Code&quot;">​</a></h4><p>If you have custom code calling the old AJAX files:</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Old way</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Core/ajax_save_setting.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { k: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mykey&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, v: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;myvalue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// New way</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api.php/v1/settings&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mykey&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;myvalue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span></code></pre></div><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Old way</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;inc/ajax_load_feed.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    NfID: feedId, NfSourceURI: uri, NfName: name, NfOptions: opts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// New way</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api.php/v1/feeds/&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> feedId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/load&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: name, source_uri: uri, options: opts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h4 id="module-api-handlers" tabindex="-1">Module API Handlers <a class="header-anchor" href="#module-api-handlers" aria-label="Permalink to &quot;Module API Handlers&quot;">​</a></h4><p>In addition to the centralized API handlers, each module provides its own API handler in <code>src/Modules/*/Http/</code>:</p><table tabindex="0"><thead><tr><th>Module</th><th>Handler</th><th>Key Endpoints</th></tr></thead><tbody><tr><td>Text</td><td><code>TextApiHandler</code></td><td><code>/api/v1/texts</code>, <code>/api/v1/texts/{id}</code></td></tr><tr><td>Vocabulary</td><td><code>VocabularyApiHandler</code></td><td><code>/api/v1/terms</code>, <code>/api/v1/terms/{id}/status</code></td></tr><tr><td>Language</td><td><code>LanguageApiHandler</code></td><td><code>/api/v1/languages</code>, <code>/api/v1/language-definitions</code></td></tr><tr><td>Tags</td><td><code>TagsApiHandler</code></td><td><code>/api/v1/tags</code>, <code>/api/v1/text-tags</code></td></tr><tr><td>Review</td><td><code>ReviewApiHandler</code></td><td><code>/api/v1/review/start</code>, <code>/api/v1/review/submit</code></td></tr><tr><td>Feed</td><td><code>FeedApiHandler</code></td><td><code>/api/v1/feeds</code>, <code>/api/v1/feeds/{id}/articles</code></td></tr><tr><td>Admin</td><td><code>AdminApiHandler</code></td><td><code>/api/v1/settings</code>, <code>/api/v1/backup</code></td></tr><tr><td>User</td><td><code>UserApiHandler</code></td><td><code>/api/v1/auth/login</code>, <code>/api/v1/auth/logout</code></td></tr><tr><td>Dictionary</td><td><code>DictionaryApiHandler</code></td><td><code>/api/v1/dictionary/lookup</code></td></tr></tbody></table><h2 id="code-monolith-splitting" tabindex="-1">Code Monolith Splitting <a class="header-anchor" href="#code-monolith-splitting" aria-label="Permalink to &quot;Code Monolith Splitting&quot;">​</a></h2><p>Version 3 breaks up the large monolithic PHP files into smaller, focused modules for better maintainability.</p><h3 id="core-directory-organization" tabindex="-1">Core Directory Organization <a class="header-anchor" href="#core-directory-organization" aria-label="Permalink to &quot;Core Directory Organization&quot;">​</a></h3><p>The <code>src/backend/Core/</code> directory is organized into subdirectories by concern:</p><table tabindex="0"><thead><tr><th>Directory</th><th>Purpose</th></tr></thead><tbody><tr><td><code>Bootstrap/</code></td><td>Application initialization (EnvLoader, db_bootstrap, start_session)</td></tr><tr><td><code>Database/</code></td><td>Database classes (Connection, DB, Escaping, Settings)</td></tr><tr><td><code>Entity/</code></td><td>Entity classes (Language, Term, Text)</td></tr><tr><td><code>Export/</code></td><td>Export functionality (Anki, TSV)</td></tr><tr><td><code>Feed/</code></td><td>RSS feed handling</td></tr><tr><td><code>Http/</code></td><td>HTTP utilities</td></tr><tr><td><code>Integration/</code></td><td>External integrations</td></tr><tr><td><code>Language/</code></td><td>Language processing</td></tr><tr><td><code>Media/</code></td><td>Media file handling</td></tr><tr><td><code>Mobile/</code></td><td>Mobile interface logic</td></tr><tr><td><code>Tag/</code></td><td>Tag management</td></tr><tr><td><code>Review/</code></td><td>Review/spaced repetition logic</td></tr><tr><td><code>Text/</code></td><td>Text processing</td></tr><tr><td><code>UI/</code></td><td>UI helper functions</td></tr><tr><td><code>Utils/</code></td><td>General utilities</td></tr><tr><td><code>Word/</code></td><td>Word/term processing</td></tr></tbody></table><h3 id="database-connect-php-split" tabindex="-1">database_connect.php Split <a class="header-anchor" href="#database-connect-php-split" aria-label="Permalink to &quot;database_connect.php Split&quot;">​</a></h3><p>The original <code>database_connect.php</code> was split into focused modules:</p><table tabindex="0"><thead><tr><th>New File</th><th>Purpose</th></tr></thead><tbody><tr><td><code>database_connect.php</code></td><td>Core database connection and query wrappers</td></tr><tr><td><code>tags.php</code></td><td>Tag management functions</td></tr><tr><td><code>feeds.php</code></td><td>RSS feed handling functions</td></tr><tr><td><code>settings.php</code></td><td>Application settings management</td></tr></tbody></table><h3 id="session-utility-php-split" tabindex="-1">session_utility.php Split <a class="header-anchor" href="#session-utility-php-split" aria-label="Permalink to &quot;session_utility.php Split&quot;">​</a></h3><p>The original <code>session_utility.php</code> (4300+ lines) was split into multiple files:</p><table tabindex="0"><thead><tr><th>New File</th><th>Lines</th><th>Purpose</th></tr></thead><tbody><tr><td><code>session_utility.php</code></td><td>~1,000</td><td>Core session functions, navigation, media handling, string utilities</td></tr><tr><td><code>export_helpers.php</code></td><td>~240</td><td>Export functions (Anki, TSV, flexible format exports)</td></tr><tr><td><code>text_helpers.php</code></td><td>~2,100</td><td>Text/sentence processing, MeCab integration, annotations, expression handling</td></tr></tbody></table><p>UI helper functions previously in <code>ui_helpers.php</code> have been migrated to proper MVC View Helper classes:</p><ul><li><code>PageLayoutHelper</code> - Page headers, footers, logos</li><li><code>StatusHelper</code> - Status indicators and conditions</li><li><code>SelectOptionsBuilder</code> - Select/dropdown option generation</li></ul><p>All functions remain in the global namespace for backward compatibility. The <code>session_utility.php</code> file requires the helper files automatically:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">require_once</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __DIR__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/export_helpers.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">require_once</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __DIR__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/text_helpers.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="language-definitions-as-json" tabindex="-1">Language Definitions as JSON <a class="header-anchor" href="#language-definitions-as-json" aria-label="Permalink to &quot;Language Definitions as JSON&quot;">​</a></h3><p>Version 3 converts the language definitions from a PHP array to a JSON file for better maintainability and separation of data from code.</p><h4 id="before-v2" tabindex="-1">Before (v2) <a class="header-anchor" href="#before-v2" aria-label="Permalink to &quot;Before (v2)&quot;">​</a></h4><p>Language definitions were hardcoded in <code>langdefs.php</code> as a PHP array:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;LWT_LANGUAGES_ARRAY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;English&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a-zA-ZÀ-ÖØ-öø-ȳЀ-ӹ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;.!?:;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... 38 more languages</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div><h4 id="after-v3" tabindex="-1">After (v3) <a class="header-anchor" href="#after-v3" aria-label="Permalink to &quot;After (v3)&quot;">​</a></h4><p>Language definitions are stored in <code>langdefs.json</code> with descriptive keys:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;English&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;glosbeIso&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;googleIso&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;biggerFont&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;wordCharRegExp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a-zA-ZÀ-ÖØ-öø-ȳЀ-ӹ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;sentSplRegExp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.!?:;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;makeCharacterWord&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;removeSpaces&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;rightToLeft&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The <code>langdefs.php</code> file now loads the JSON and converts it to the legacy indexed array format for backward compatibility:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;LWT_LANGUAGES_ARRAY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadLanguageDefinitions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre></div><h4 id="benefits-of-this-change" tabindex="-1">Benefits of this change <a class="header-anchor" href="#benefits-of-this-change" aria-label="Permalink to &quot;Benefits of this change&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Aspect</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>Data format</td><td>PHP code</td><td>Pure JSON data</td></tr><tr><td>Field names</td><td>Numeric indices (0-7)</td><td>Descriptive keys</td></tr><tr><td>Editability</td><td>Requires PHP knowledge</td><td>Human-readable JSON</td></tr><tr><td>Reusability</td><td>PHP only</td><td>Any language can parse JSON</td></tr><tr><td>Validation</td><td>Runtime errors</td><td>JSON schema validation possible</td></tr></tbody></table><h4 id="field-mapping" tabindex="-1">Field Mapping <a class="header-anchor" href="#field-mapping" aria-label="Permalink to &quot;Field Mapping&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Index</th><th>JSON Key</th><th>Description</th></tr></thead><tbody><tr><td>0</td><td><code>glosbeIso</code></td><td>ISO code for Glosbe dictionary</td></tr><tr><td>1</td><td><code>googleIso</code></td><td>ISO code for Google Translate</td></tr><tr><td>2</td><td><code>biggerFont</code></td><td>Whether to use larger font size</td></tr><tr><td>3</td><td><code>wordCharRegExp</code></td><td>Regex for valid word characters</td></tr><tr><td>4</td><td><code>sentSplRegExp</code></td><td>Regex for sentence splitting</td></tr><tr><td>5</td><td><code>makeCharacterWord</code></td><td>Treat each character as a word (CJK)</td></tr><tr><td>6</td><td><code>removeSpaces</code></td><td>Remove spaces between words (CJK)</td></tr><tr><td>7</td><td><code>rightToLeft</code></td><td>Right-to-left text direction</td></tr></tbody></table><h3 id="_13-database-engine-migration-myisam-→-innodb" tabindex="-1">13. Database Engine Migration (MyISAM → InnoDB) <a class="header-anchor" href="#_13-database-engine-migration-myisam-→-innodb" aria-label="Permalink to &quot;13. Database Engine Migration (MyISAM → InnoDB)&quot;">​</a></h3><p>Version 3 migrates all database tables from MyISAM to InnoDB engine.</p><h4 id="changes" tabindex="-1">Changes <a class="header-anchor" href="#changes" aria-label="Permalink to &quot;Changes&quot;">​</a></h4><ul><li>All 14 permanent tables converted from MyISAM to InnoDB</li><li>Temporary tables (<code>temptextitems</code>, <code>tempwords</code>) remain MEMORY engine</li><li>Migration file: <code>db/migrations/20251130_120000_myisam_to_innodb.sql</code></li></ul><h4 id="benefits-of-moving-to-innodb" tabindex="-1">Benefits of moving to InnoDB <a class="header-anchor" href="#benefits-of-moving-to-innodb" aria-label="Permalink to &quot;Benefits of moving to InnoDB&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Feature</th><th>MyISAM</th><th>InnoDB</th></tr></thead><tbody><tr><td>Transactions</td><td>No</td><td>Yes (ACID)</td></tr><tr><td>Locking</td><td>Table-level</td><td>Row-level</td></tr><tr><td>Foreign keys</td><td>No</td><td>Yes</td></tr><tr><td>Crash recovery</td><td>Limited</td><td>Full</td></tr></tbody></table><h4 id="migration-notes" tabindex="-1">Migration Notes <a class="header-anchor" href="#migration-notes" aria-label="Permalink to &quot;Migration Notes&quot;">​</a></h4><ul><li>Existing installations: Tables are converted automatically when running database updates</li><li>New installations: Tables are created directly with InnoDB engine</li><li>No code changes required - queries work identically</li></ul><p>This change prepares LWT for future improvements including foreign key constraints and transaction support for multi-step operations.</p><h3 id="_14-shared-infrastructure-layer" tabindex="-1">14. Shared Infrastructure Layer <a class="header-anchor" href="#_14-shared-infrastructure-layer" aria-label="Permalink to &quot;14. Shared Infrastructure Layer&quot;">​</a></h3><p>Version 3 introduces a <code>src/Shared/</code> directory containing cross-cutting infrastructure code that is used across all feature modules.</p><h4 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to &quot;Directory Structure&quot;">​</a></h4><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/Shared/</span></span>
<span class="line"><span>├── Domain/</span></span>
<span class="line"><span>│   └── ValueObjects/</span></span>
<span class="line"><span>│       └── UserId.php              # User identity value object</span></span>
<span class="line"><span>├── Infrastructure/</span></span>
<span class="line"><span>│   ├── Container/                  # Dependency Injection</span></span>
<span class="line"><span>│   │   ├── Container.php           # PSR-11 compatible DI container</span></span>
<span class="line"><span>│   │   ├── ContainerInterface.php  # Container interface</span></span>
<span class="line"><span>│   │   ├── ServiceProviderInterface.php</span></span>
<span class="line"><span>│   │   ├── CoreServiceProvider.php</span></span>
<span class="line"><span>│   │   ├── ControllerServiceProvider.php</span></span>
<span class="line"><span>│   │   ├── RepositoryServiceProvider.php</span></span>
<span class="line"><span>│   │   ├── ContainerException.php</span></span>
<span class="line"><span>│   │   └── NotFoundException.php</span></span>
<span class="line"><span>│   ├── Database/                   # Database utilities</span></span>
<span class="line"><span>│   │   ├── Connection.php          # mysqli wrapper (singleton)</span></span>
<span class="line"><span>│   │   ├── PreparedStatement.php   # Safe parameterized queries</span></span>
<span class="line"><span>│   │   ├── QueryBuilder.php        # Fluent SQL builder</span></span>
<span class="line"><span>│   │   ├── DB.php                  # Static database helpers</span></span>
<span class="line"><span>│   │   ├── UserScopedQuery.php     # Auto user-filtering</span></span>
<span class="line"><span>│   │   ├── Settings.php            # Key-value settings</span></span>
<span class="line"><span>│   │   ├── Configuration.php       # Database config</span></span>
<span class="line"><span>│   │   ├── Escaping.php            # SQL escaping</span></span>
<span class="line"><span>│   │   ├── Validation.php          # Value validation</span></span>
<span class="line"><span>│   │   ├── Maintenance.php         # DB maintenance</span></span>
<span class="line"><span>│   │   ├── Migrations.php          # Migration tracking</span></span>
<span class="line"><span>│   │   ├── SqlFileParser.php       # SQL file parsing</span></span>
<span class="line"><span>│   │   ├── Restore.php             # Database restore</span></span>
<span class="line"><span>│   │   └── TextParsing.php         # Text parsing utilities</span></span>
<span class="line"><span>│   └── Http/                       # HTTP utilities</span></span>
<span class="line"><span>│       ├── InputValidator.php      # Type-safe request validation</span></span>
<span class="line"><span>│       ├── SecurityHeaders.php     # Security header management</span></span>
<span class="line"><span>│       └── UrlUtilities.php        # URL generation</span></span>
<span class="line"><span>└── UI/</span></span>
<span class="line"><span>    ├── Assets/</span></span>
<span class="line"><span>    │   └── ViteHelper.php          # Vite asset loading</span></span>
<span class="line"><span>    └── Helpers/</span></span>
<span class="line"><span>        ├── FormHelper.php          # Form attribute generation</span></span>
<span class="line"><span>        ├── PageLayoutHelper.php    # Page layout elements</span></span>
<span class="line"><span>        ├── IconHelper.php          # Lucide SVG icons</span></span>
<span class="line"><span>        ├── TagHelper.php           # HTML tag utilities</span></span>
<span class="line"><span>        └── SelectOptionsBuilder.php # Select option building</span></span></code></pre></div><h4 id="key-components" tabindex="-1">Key Components <a class="header-anchor" href="#key-components" aria-label="Permalink to &quot;Key Components&quot;">​</a></h4><p><strong>Database Classes:</strong></p><table tabindex="0"><thead><tr><th>Class</th><th>Purpose</th></tr></thead><tbody><tr><td><code>Connection</code></td><td>Singleton mysqli wrapper with query execution</td></tr><tr><td><code>PreparedStatement</code></td><td>Safe parameterized query execution</td></tr><tr><td><code>QueryBuilder</code></td><td>Fluent SQL builder with prepared statement support</td></tr><tr><td><code>DB</code></td><td>Static helper methods for common database operations</td></tr><tr><td><code>UserScopedQuery</code></td><td>Automatic user filtering for multi-user mode</td></tr></tbody></table><p><strong>HTTP Utilities:</strong></p><table tabindex="0"><thead><tr><th>Class</th><th>Purpose</th></tr></thead><tbody><tr><td><code>InputValidator</code></td><td>Type-safe request parameter access (<code>getString()</code>, <code>getInt()</code>, <code>getBool()</code>)</td></tr><tr><td><code>SecurityHeaders</code></td><td>Security header management</td></tr><tr><td><code>UrlUtilities</code></td><td>URL generation and manipulation</td></tr></tbody></table><p><strong>UI Helpers:</strong></p><table tabindex="0"><thead><tr><th>Class</th><th>Purpose</th></tr></thead><tbody><tr><td><code>FormHelper</code></td><td>HTML form attributes (checked, selected)</td></tr><tr><td><code>PageLayoutHelper</code></td><td>Navbar, footers, menus</td></tr><tr><td><code>IconHelper</code></td><td>Lucide SVG icon rendering (replaces legacy PNG icons)</td></tr><tr><td><code>TagHelper</code></td><td>HTML tag generation</td></tr><tr><td><code>SelectOptionsBuilder</code></td><td>HTML select option building</td></tr><tr><td><code>ViteHelper</code></td><td>Vite CSS/JS bundle loading</td></tr></tbody></table><h4 id="usage-examples" tabindex="-1">Usage Examples <a class="header-anchor" href="#usage-examples" aria-label="Permalink to &quot;Usage Examples&quot;">​</a></h4><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Database\\Connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Database\\QueryBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Http\\InputValidator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Database queries with prepared statements</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$words </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Connection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preparedFetchAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> words </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WoLgID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [$languageId]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Fluent query builder</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$texts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> QueryBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;texts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TxLgID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;=&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $langId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orderBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TxTitle&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Type-safe input validation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$validator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> InputValidator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($_REQUEST);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$textId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $validator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;text&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $validator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;title&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_15-modular-architecture-src-modules" tabindex="-1">15. Modular Architecture (src/Modules) <a class="header-anchor" href="#_15-modular-architecture-src-modules" aria-label="Permalink to &quot;15. Modular Architecture (src/Modules)&quot;">​</a></h3><p>Version 3 introduces a modular architecture with 10 feature modules, each following Clean Architecture principles.</p><h4 id="module-list" tabindex="-1">Module List <a class="header-anchor" href="#module-list" aria-label="Permalink to &quot;Module List&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Module</th><th>Purpose</th></tr></thead><tbody><tr><td><code>Admin</code></td><td>Administration, settings, backup, statistics</td></tr><tr><td><code>Dictionary</code></td><td>Dictionary integrations and local dictionaries</td></tr><tr><td><code>Feed</code></td><td>RSS feed management</td></tr><tr><td><code>Home</code></td><td>Dashboard and landing page</td></tr><tr><td><code>Language</code></td><td>Language configuration</td></tr><tr><td><code>Review</code></td><td>Spaced repetition testing</td></tr><tr><td><code>Tags</code></td><td>Tagging system</td></tr><tr><td><code>Text</code></td><td>Text reading and management</td></tr><tr><td><code>User</code></td><td>Authentication and user management</td></tr><tr><td><code>Vocabulary</code></td><td>Terms/words management</td></tr></tbody></table><h4 id="module-structure" tabindex="-1">Module Structure <a class="header-anchor" href="#module-structure" aria-label="Permalink to &quot;Module Structure&quot;">​</a></h4><p>Each module follows a consistent structure:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/Modules/[Module]/</span></span>
<span class="line"><span>├── Application/              # Use cases and application services</span></span>
<span class="line"><span>│   ├── Facade.php           # Simplified module API</span></span>
<span class="line"><span>│   ├── Services/            # Application services</span></span>
<span class="line"><span>│   └── UseCases/            # Command/query handlers</span></span>
<span class="line"><span>├── Domain/                  # Business logic</span></span>
<span class="line"><span>│   ├── Entities/            # Domain entities</span></span>
<span class="line"><span>│   ├── ValueObjects/        # Value objects (IDs, status)</span></span>
<span class="line"><span>│   └── RepositoryInterface.php</span></span>
<span class="line"><span>├── Http/                    # Request handling</span></span>
<span class="line"><span>│   ├── Controller.php       # MVC controller</span></span>
<span class="line"><span>│   └── ApiHandler.php       # REST API handler</span></span>
<span class="line"><span>├── Infrastructure/          # External integrations</span></span>
<span class="line"><span>│   └── MySqlRepository.php  # Repository implementation</span></span>
<span class="line"><span>├── Views/                   # PHP templates</span></span>
<span class="line"><span>└── [Module]ServiceProvider.php  # DI registration</span></span></code></pre></div><h4 id="module-statistics" tabindex="-1">Module Statistics <a class="header-anchor" href="#module-statistics" aria-label="Permalink to &quot;Module Statistics&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Module</th><th>Use Cases</th><th>Services</th><th>Views</th></tr></thead><tbody><tr><td>Text</td><td>9</td><td>7</td><td>18</td></tr><tr><td>Vocabulary</td><td>7</td><td>7</td><td>22</td></tr><tr><td>Language</td><td>5</td><td>1</td><td>5</td></tr><tr><td>Tags</td><td>6</td><td>2</td><td>5</td></tr><tr><td>Review</td><td>5</td><td>3</td><td>6</td></tr><tr><td>Feed</td><td>7</td><td>4</td><td>8</td></tr><tr><td>User</td><td>5</td><td>6</td><td>6</td></tr><tr><td>Admin</td><td>7+</td><td>3</td><td>8</td></tr><tr><td>Home</td><td>3</td><td>0</td><td>2</td></tr><tr><td>Dictionary</td><td>3</td><td>2</td><td>2</td></tr></tbody></table><h4 id="use-case-pattern" tabindex="-1">Use Case Pattern <a class="header-anchor" href="#use-case-pattern" aria-label="Permalink to &quot;Use Case Pattern&quot;">​</a></h4><p>Each module uses the Use Case pattern for business operations:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/Modules/Text/Application/UseCases/ImportText.php</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lwt\\Modules\\Text\\Application\\UseCases</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ImportText</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __construct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        private</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TextRepositoryInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $repository,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        private</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TextParsingService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $parser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ImportTextRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $request)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Business logic here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title, $request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($text);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">repository</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($text);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="module-facades" tabindex="-1">Module Facades <a class="header-anchor" href="#module-facades" aria-label="Permalink to &quot;Module Facades&quot;">​</a></h4><p>Each module provides a Facade for simplified access:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Modules\\Text\\Application\\TextFacade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Modules\\Vocabulary\\Application\\VocabularyFacade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get text for reading</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $textFacade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTextForReading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($textId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Update term status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$vocabFacade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateTermStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($termId, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_16-dependency-injection-container" tabindex="-1">16. Dependency Injection Container <a class="header-anchor" href="#_16-dependency-injection-container" aria-label="Permalink to &quot;16. Dependency Injection Container&quot;">​</a></h3><p>Version 3 introduces a PSR-11 compatible dependency injection container.</p><h4 id="container-features" tabindex="-1">Container Features <a class="header-anchor" href="#container-features" aria-label="Permalink to &quot;Container Features&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Feature</th><th>Description</th></tr></thead><tbody><tr><td>Singleton support</td><td>Services registered as singletons are reused</td></tr><tr><td>Factory pattern</td><td>Fresh instances created on each request</td></tr><tr><td>Auto-wiring</td><td>Dependencies resolved via reflection</td></tr><tr><td>Service aliases</td><td>Alternative names for services</td></tr><tr><td>Circular detection</td><td>Prevents circular dependency loops</td></tr><tr><td>Typed retrieval</td><td><code>getTyped()</code> for static analysis</td></tr></tbody></table><h4 id="service-providers" tabindex="-1">Service Providers <a class="header-anchor" href="#service-providers" aria-label="Permalink to &quot;Service Providers&quot;">​</a></h4><p>Each module registers its services via a ServiceProvider:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/Modules/Text/TextServiceProvider.php</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lwt\\Modules\\Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Container\\ServiceProviderInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextServiceProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServiceProviderInterface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ContainerInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Register repository interface to implementation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            TextRepositoryInterface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            MySqlTextRepository</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Register use cases</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ImportText</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GetTextForReading</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Register facade</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TextFacade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> boot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ContainerInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Post-registration initialization</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="core-service-providers" tabindex="-1">Core Service Providers <a class="header-anchor" href="#core-service-providers" aria-label="Permalink to &quot;Core Service Providers&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Provider</th><th>Purpose</th></tr></thead><tbody><tr><td><code>CoreServiceProvider</code></td><td>Core services (Globals, database)</td></tr><tr><td><code>ControllerServiceProvider</code></td><td>All MVC controllers</td></tr><tr><td><code>RepositoryServiceProvider</code></td><td>Repository implementations</td></tr><tr><td><code>[Module]ServiceProvider</code></td><td>Module-specific services</td></tr></tbody></table><h4 id="container-usage" tabindex="-1">Container Usage <a class="header-anchor" href="#container-usage" aria-label="Permalink to &quot;Container Usage&quot;">​</a></h4><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Container\\Container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get the container</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$container </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Retrieve a service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$textFacade </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TextFacade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Typed retrieval (for static analysis)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$textFacade </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTyped</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TextFacade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TextFacade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create fresh instance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$service </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SomeService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_17-multi-user-support" tabindex="-1">17. Multi-User Support <a class="header-anchor" href="#_17-multi-user-support" aria-label="Permalink to &quot;17. Multi-User Support&quot;">​</a></h3><p>Version 3 adds optional multi-user support for shared installations.</p><h4 id="enabling-multi-user-mode" tabindex="-1">Enabling Multi-User Mode <a class="header-anchor" href="#enabling-multi-user-mode" aria-label="Permalink to &quot;Enabling Multi-User Mode&quot;">​</a></h4><p>Set in <code>.env</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MULTI_USER_ENABLED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span></span></code></pre></div><h4 id="user-scoped-tables" tabindex="-1">User-Scoped Tables <a class="header-anchor" href="#user-scoped-tables" aria-label="Permalink to &quot;User-Scoped Tables&quot;">​</a></h4><p>When multi-user mode is enabled, the following tables are automatically filtered by user:</p><table tabindex="0"><thead><tr><th>Table</th><th>User ID Column</th></tr></thead><tbody><tr><td><code>languages</code></td><td><code>LgUsID</code></td></tr><tr><td><code>texts</code></td><td><code>TxUsID</code></td></tr><tr><td><code>archivedtexts</code></td><td><code>AtUsID</code></td></tr><tr><td><code>words</code></td><td><code>WoUsID</code></td></tr><tr><td><code>tags</code></td><td><code>TgUsID</code></td></tr><tr><td><code>tags2</code></td><td><code>T2UsID</code></td></tr><tr><td><code>newsfeeds</code></td><td><code>NfUsID</code></td></tr><tr><td><code>settings</code></td><td><code>StUsID</code></td></tr><tr><td><code>local_dictionaries</code></td><td><code>LdUsID</code></td></tr></tbody></table><h4 id="userid-value-object" tabindex="-1">UserId Value Object <a class="header-anchor" href="#userid-value-object" aria-label="Permalink to &quot;UserId Value Object&quot;">​</a></h4><p>User identity is represented by an immutable value object:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Domain\\ValueObjects\\UserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create from integer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UserId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fromInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create for unsaved user (value 0)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UserId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsaved</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get the integer value</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check if saved</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($userId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isSaved</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // User exists in database</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="userscopedquery" tabindex="-1">UserScopedQuery <a class="header-anchor" href="#userscopedquery" aria-label="Permalink to &quot;UserScopedQuery&quot;">​</a></h4><p>The <code>UserScopedQuery</code> class automatically adds user filtering:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Shared\\Infrastructure\\Database\\UserScopedQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Automatically adds WHERE clause for current user</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UserScopedQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;texts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$texts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TxLgID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;=&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $langId)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h4 id="accessing-current-user" tabindex="-1">Accessing Current User <a class="header-anchor" href="#accessing-current-user" aria-label="Permalink to &quot;Accessing Current User&quot;">​</a></h4><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Lwt\\Core\\Globals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get current user ID (may be null)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get user ID or throw exception</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requireUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check if multi-user is enabled</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Globals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isMultiUserEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Apply user filtering</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_18-javascript-to-php-communication-modernization" tabindex="-1">18. JavaScript-to-PHP Communication Modernization <a class="header-anchor" href="#_18-javascript-to-php-communication-modernization" aria-label="Permalink to &quot;18. JavaScript-to-PHP Communication Modernization&quot;">​</a></h3><p>Version 3 modernizes all JavaScript-to-PHP communication, replacing legacy patterns with a unified REST API approach.</p><h4 id="changes-1" tabindex="-1">Changes <a class="header-anchor" href="#changes-1" aria-label="Permalink to &quot;Changes&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Aspect</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>AJAX calls</td><td>jQuery <code>$.post()</code>, <code>$.getJSON()</code></td><td>Native <code>fetch()</code> API</td></tr><tr><td>Word operations</td><td>Frame navigation (<code>target=&quot;ro&quot;</code>)</td><td>REST API with in-page updates</td></tr><tr><td>Result display</td><td>iframe content replacement</td><td>Result panels and modals</td></tr><tr><td>Audio control</td><td><code>window.parent.frames</code> access</td><td>Direct module imports</td></tr></tbody></table><h4 id="new-frontend-api-layer" tabindex="-1">New Frontend API Layer <a class="header-anchor" href="#new-frontend-api-layer" aria-label="Permalink to &quot;New Frontend API Layer&quot;">​</a></h4><p>Type-safe API client modules in <code>src/frontend/js/</code>:</p><ul><li><code>shared/api/client.ts</code> - Centralized fetch wrapper</li><li><code>modules/vocabulary/api/terms_api.ts</code> - Term/word operations</li><li><code>modules/text/api/texts_api.ts</code> - Text operations</li><li><code>modules/review/api/review_api.ts</code> - Review operations</li><li><code>modules/admin/api/settings_api.ts</code> - Settings operations</li></ul><h4 id="api-mode" tabindex="-1">API Mode <a class="header-anchor" href="#api-mode" aria-label="Permalink to &quot;API Mode&quot;">​</a></h4><p>The frontend uses <strong>API mode by default</strong> for word operations, providing:</p><ul><li>Faster status changes (no iframe reload)</li><li>Better mobile experience</li><li>Reduced server load</li><li>In-page result panels instead of frame navigation</li></ul><p>Legacy frame mode can be enabled via <code>LWT_DATA.settings.use_frame_mode = true</code> for backward compatibility.</p><h4 id="removed-legacy-files" tabindex="-1">Removed Legacy Files <a class="header-anchor" href="#removed-legacy-files" aria-label="Permalink to &quot;Removed Legacy Files&quot;">​</a></h4><p>All legacy PHP endpoint files have been removed:</p><table tabindex="0"><thead><tr><th>Removed File</th><th>Replacement</th></tr></thead><tbody><tr><td><code>set_word_status.php</code></td><td><code>PUT /api/v1/terms/{id}/status/{status}</code></td></tr><tr><td><code>delete_word.php</code></td><td><code>DELETE /api/v1/terms/{id}</code></td></tr><tr><td><code>insert_word_wellknown.php</code></td><td><code>POST /api/v1/terms/quick</code> (status=99)</td></tr><tr><td><code>insert_word_ignore.php</code></td><td><code>POST /api/v1/terms/quick</code> (status=98)</td></tr><tr><td><code>inline_edit.php</code></td><td><code>/word/inline-edit</code> route</td></tr><tr><td><code>set_test_status.php</code></td><td><code>PUT /api/v1/review/status</code></td></tr><tr><td><code>trans.php</code></td><td>Direct dictionary URLs</td></tr></tbody></table><h2 id="future-improvements" tabindex="-1">Future Improvements <a class="header-anchor" href="#future-improvements" aria-label="Permalink to &quot;Future Improvements&quot;">​</a></h2><p>This refactoring enables:</p><ol><li><strong>Unit testing:</strong> Use cases, services, and repositories are fully testable in isolation</li><li><strong>Cleaner URLs:</strong> SEO-friendly URLs without <code>.php</code> extensions</li><li><strong>Modular architecture:</strong> 10 feature modules with clear boundaries</li><li><strong>Namespace support:</strong> PHP autoloading with PSR-4 namespaces</li><li><strong>Explicit dependencies:</strong> DI container makes dependencies visible and swappable</li><li><strong>Modern configuration:</strong> <code>.env</code> files work with Docker, CI/CD, and modern deployment workflows</li><li><strong>API versioning:</strong> Structured API handlers allow for future API versions</li><li><strong>Multi-user support:</strong> Data isolation for shared installations</li><li><strong>Clean Architecture:</strong> Domain, Application, and Infrastructure layers are separated</li><li><strong>Repository pattern:</strong> Database access abstracted behind interfaces for future ORM migration</li></ol><h2 id="commit-history" tabindex="-1">Commit History <a class="header-anchor" href="#commit-history" aria-label="Permalink to &quot;Commit History&quot;">​</a></h2><p>The v3 branch includes the following key commits (in chronological order):</p><ol><li><code>125edc4e</code> - Initial refactor: moves PHP files to src folder with router for backward compatibility</li><li><code>e53b8387</code> - Moves <code>inc/</code> to <code>src/php/inc</code></li><li><code>cfb4cb7c</code> - Adds router test suite, fixes non-existing route</li><li><code>fbc64369</code> - Fixes routing globals passing, adds missing <code>empty.html</code> file</li><li><code>4369a1c0</code> - Implements MVC structure, fixes static assets paths</li><li><code>48e84eac</code> - Moves files and static assets to unclutter the root folder</li><li><code>f2ab173a</code> - Clearly separates front-end files from PHP backend</li><li><code>15a1b011</code> - Renames <code>src/php/</code> to <code>src/backend/</code>, moves inc to Core</li><li>Recent commits - Ongoing MVC migration (feeds, word edit, admin, home controllers)</li></ol>`,289)])])}const g=t(n,[["render",d]]);export{k as __pageData,g as default};
