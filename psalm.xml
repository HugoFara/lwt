<?xml version="1.0"?>
<psalm
    errorLevel="2"
    resolveFromConfigFile="true"
    findUnusedBaselineEntry="true"
    findUnusedCode="true"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="https://getpsalm.org/schema/config"
    xsi:schemaLocation="https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd"
    errorBaseline="psalm-baseline-level1.xml"
>
    <projectFiles>
        <directory name="." />
        <ignoreFiles>
            <directory name="vendor" />
            <directory name="node_modules" />
            <directory name="assets" />
            <directory name="docs" />
            <directory name="src/tools" />
            <directory name="tests" />
        </ignoreFiles>
    </projectFiles>

    <issueHandlers>
        <!-- Views use variables passed from controllers via extract() -->
        <UndefinedGlobalVariable>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
                <directory name="src/Modules" />
            </errorLevel>
        </UndefinedGlobalVariable>

        <!-- Views receive variables via extract(), psalm cannot verify they are defined -->
        <PossiblyUndefinedVariable>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
                <directory name="src/Modules" />
            </errorLevel>
        </PossiblyUndefinedVariable>

        <!-- Controllers pass variables to views, services have template vars -->
        <UnusedVariable>
            <errorLevel type="suppress">
                <directory name="src/backend/Controllers" />
                <directory name="src/backend/Views" />
                <directory name="src/Modules" />
            </errorLevel>
        </UnusedVariable>

        <!-- Methods may have unused params for interface conformance or future use -->
        <PossiblyUnusedParam>
            <errorLevel type="suppress">
                <directory name="src/backend/Controllers" />
                <directory name="src/backend/View" />
                <directory name="src/Modules" />
                <directory name="src/Shared" />
            </errorLevel>
        </PossiblyUnusedParam>

        <!-- Public methods called via routing or kept for API completeness -->
        <PossiblyUnusedMethod>
            <errorLevel type="suppress">
                <directory name="src/backend/Controllers" />
                <directory name="src/backend/Api" />
                <directory name="src/backend/Core" />
                <directory name="src/backend/View" />
                <directory name="src/Modules" />
                <directory name="src/Shared" />
            </errorLevel>
        </PossiblyUnusedMethod>

        <!-- Views call global functions that may be dynamically loaded -->
        <UndefinedFunction>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
                <directory name="src/Modules" />
            </errorLevel>
        </UndefinedFunction>

        <!-- Defensive null/type checks for safety with dynamic data -->
        <RedundantCondition>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
                <directory name="src/Modules" />
            </errorLevel>
        </RedundantCondition>

        <!-- Views receive variables from controllers via extract(), psalm cannot infer types -->
        <TypeDoesNotContainType>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
                <directory name="src/Modules" />
            </errorLevel>
        </TypeDoesNotContainType>

        <!-- View files document expected template variables with @var annotations -->
        <UnnecessaryVarAnnotation>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
                <directory name="src/Modules" />
            </errorLevel>
        </UnnecessaryVarAnnotation>

        <!-- Views receive untyped data via extract() from controllers -->
        <MixedArgument>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </MixedArgument>

        <MixedArrayAccess>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </MixedArrayAccess>

        <MixedArrayOffset>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </MixedArrayOffset>

        <MixedAssignment>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </MixedAssignment>

        <MixedMethodCall>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </MixedMethodCall>

        <MixedOperand>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </MixedOperand>

        <!-- Docblock contradictions in views due to extract() pattern -->
        <DocblockTypeContradiction>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </DocblockTypeContradiction>

        <!-- Redundant casts in views for safety with dynamic data -->
        <RedundantCast>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </RedundantCast>

        <RedundantCastGivenDocblockType>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </RedundantCastGivenDocblockType>

        <!-- Truthy/falsy comparisons in views for safety with dynamic data -->
        <RiskyTruthyFalsyComparison>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </RiskyTruthyFalsyComparison>

        <!-- Return value may not be used by callers -->
        <PossiblyUnusedReturnValue>
            <errorLevel type="suppress">
                <directory name="src/Modules" />
                <directory name="src/Shared" />
            </errorLevel>
        </PossiblyUnusedReturnValue>

        <!-- Unused properties may be kept for future use or DI -->
        <UnusedProperty>
            <errorLevel type="suppress">
                <directory name="src/Modules" />
                <directory name="src/Shared" />
            </errorLevel>
        </UnusedProperty>

        <!-- Classes may be used via DI container or routing -->
        <UnusedClass>
            <errorLevel type="suppress">
                <directory name="src/backend/Controllers" />
                <directory name="src/backend/Api" />
                <directory name="src/Modules" />
                <directory name="src/Shared" />
            </errorLevel>
        </UnusedClass>

        <!-- Closure params for DI may not be used -->
        <UnusedClosureParam>
            <errorLevel type="suppress">
                <directory name="src/Modules" />
            </errorLevel>
        </UnusedClosureParam>

        <!-- Private methods may have unused params for consistency or future use -->
        <UnusedParam>
            <errorLevel type="suppress">
                <directory name="src/Modules" />
            </errorLevel>
        </UnusedParam>

        <!-- Repository implementations may have more specific param types -->
        <MoreSpecificImplementedParamType>
            <errorLevel type="suppress">
                <directory name="src/Modules" />
                <directory name="src/backend/Core" />
            </errorLevel>
        </MoreSpecificImplementedParamType>

        <!-- Repository implementations may have less specific return types -->
        <LessSpecificImplementedReturnType>
            <errorLevel type="suppress">
                <directory name="src/Modules" />
                <directory name="src/backend/Core" />
            </errorLevel>
        </LessSpecificImplementedReturnType>

        <!-- Interface implementations may have different parameter names -->
        <ParamNameMismatch>
            <errorLevel type="suppress">
                <directory name="src/Modules" />
                <directory name="src/backend/Core" />
            </errorLevel>
        </ParamNameMismatch>
    </issueHandlers>
</psalm>
