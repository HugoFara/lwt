<?xml version="1.0"?>
<psalm
    errorLevel="4"
    resolveFromConfigFile="true"
    findUnusedBaselineEntry="true"
    findUnusedCode="true"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="https://getpsalm.org/schema/config"
    xsi:schemaLocation="https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd"
>
    <projectFiles>
        <directory name="." />
        <ignoreFiles>
            <directory name="vendor" />
            <directory name="node_modules" />
            <directory name="assets" />
            <directory name="docs" />
            <directory name="src/tools" />
            <directory name="tests" />
        </ignoreFiles>
    </projectFiles>

    <issueHandlers>
        <!-- Views use variables passed from controllers via extract() -->
        <UndefinedGlobalVariable>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </UndefinedGlobalVariable>

        <!-- Controllers pass variables to views, services have template vars -->
        <UnusedVariable>
            <errorLevel type="suppress">
                <directory name="src/backend/Controllers" />
                <directory name="src/backend/Views" />
                <directory name="src/backend/Services" />
            </errorLevel>
        </UnusedVariable>

        <!-- Methods may have unused params for interface conformance or future use -->
        <PossiblyUnusedParam>
            <errorLevel type="suppress">
                <directory name="src/backend/Controllers" />
                <directory name="src/backend/Services" />
                <directory name="src/backend/View" />
            </errorLevel>
        </PossiblyUnusedParam>

        <!-- Public methods called via routing or kept for API completeness -->
        <PossiblyUnusedMethod>
            <errorLevel type="suppress">
                <directory name="src/backend/Controllers" />
                <directory name="src/backend/Api" />
                <directory name="src/backend/Core" />
                <directory name="src/backend/Services" />
                <directory name="src/backend/View" />
            </errorLevel>
        </PossiblyUnusedMethod>

        <!-- Views call global functions that may be dynamically loaded -->
        <UndefinedFunction>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </UndefinedFunction>

        <!-- Defensive null/type checks for safety with dynamic data -->
        <RedundantCondition>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </RedundantCondition>

        <!-- Views receive variables from controllers via extract(), psalm cannot infer types -->
        <TypeDoesNotContainType>
            <errorLevel type="suppress">
                <directory name="src/backend/Views" />
            </errorLevel>
        </TypeDoesNotContainType>

        <!-- Return value may not be used by callers -->
        <PossiblyUnusedReturnValue>
            <errorLevel type="suppress">
                <directory name="src/backend/Services" />
            </errorLevel>
        </PossiblyUnusedReturnValue>
    </issueHandlers>
</psalm>
